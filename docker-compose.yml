# ============================================
# OpenCode WebUI - Docker Compose
# ============================================
#
# 使用方法:
#   cp .env.example .env    # 填写 API Key
#   docker compose up -d    # 启动
#
# 物理机 nginx 反向代理到容器暴露的端口即可

services:
  opencode:
    build:
      context: .
      dockerfile: Dockerfile    # 完整版；换 Dockerfile.frontend 只部署前端
    container_name: opencode-webui
    restart: unless-stopped
    ports:
      - "127.0.0.1:${FRONTEND_PORT:-3000}:3000"
      - "127.0.0.1:${API_PORT:-4096}:4096"
    volumes:
      - ${WORKSPACE:-./workspace}:/workspace
      - opencode-data:/root/.local/share/opencode
      - opencode-config:/root/.config/opencode
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY:-}
      - GROQ_API_KEY=${GROQ_API_KEY:-}
      - MISTRAL_API_KEY=${MISTRAL_API_KEY:-}
      - XAI_API_KEY=${XAI_API_KEY:-}
      - OPENCODE_SERVER_PASSWORD=${OPENCODE_SERVER_PASSWORD:-}
      - OPENCODE_SERVER_USERNAME=${OPENCODE_SERVER_USERNAME:-opencode}
      - WORKSPACE=/workspace

volumes:
  opencode-data:
  opencode-config:
