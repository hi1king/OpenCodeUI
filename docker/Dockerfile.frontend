# ============================================
# OpenCode WebUI - Frontend
# ============================================
# 纯前端静态文件 + Caddy 反向代理 API

# ---- Stage 1: 构建前端 ----
FROM node:22-alpine AS builder

WORKDIR /app
COPY package.json package-lock.json ./
RUN npm ci --ignore-scripts
COPY . .
ENV VITE_API_BASE_URL=/api
RUN npm run build

# ---- Stage 2: Caddy 运行时 ----
FROM caddy:2-alpine

# 前端静态文件
COPY --from=builder /app/dist /srv

# Caddy 配置
COPY docker/Caddyfile /etc/caddy/Caddyfile

EXPOSE 3000

CMD ["caddy", "run", "--config", "/etc/caddy/Caddyfile"]
